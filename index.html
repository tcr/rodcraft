<!DOCTYPE html>

<html>
<head>
<title>RodCraft (Bobcat)</title>
<style>

html, body, canvas { width: 100%; height: 100%; margin: 0; padding: 0; display: block; }
body { background: -webkit-linear-gradient(#eee, #aaa); }

</style>
</head>
<body></body>

<script src="http://code.jquery.com/jquery.js"></script>
<script src="http://mrdoob.github.com/three.js/build/three.min.js"></script>
<script>

// camera resize: view-source:http://mrdoob.github.com/three.js/examples/webgl_interactive_cubes.html

var camera, scene, projector, renderer;
var rod, sphere, grip1, grip2;

var mouse = { x: 0, y: 0 }, INTERSECTED;

function createGrip() {
  // set up the sphere vars
  var radius = 20,
  segments = 16,
  rings = 16;

  // create a new mesh with
  // sphere geometry - we will cover
  // the sphereMaterial next!
  return new THREE.Mesh(
    new THREE.SphereGeometry(
    radius,
    segments,
    rings),

    new THREE.MeshLambertMaterial(
      {
        color: 0x0000CC,
      transparent: true,
      opacity: 0
      }));
}

function init() {

  camera = new THREE.PerspectiveCamera(
    75,
    window.innerWidth / window.innerHeight,
    1, 10000
  );
  camera.position.z = 500;

  scene = new THREE.Scene();

  rod = (function () {
    var geometry = new THREE.CubeGeometry( 10, 10, 200 );
    var material = new THREE.MeshLambertMaterial(
      {
        color: 0xFF3333
      });//new THREE.MeshBasicMaterial( { color: 0xff0000, wireframe: false } );
    return new THREE.Mesh( geometry, material );
  })();

  grip1 = createGrip();
  grip2 = createGrip();
  grip1.position.z = -100;
  grip2.position.z = 100;

  group = new THREE.Object3D();
  group.add(rod);
  group.add(grip1);
  group.add(grip2);

  group.rotation.x = Math.PI/2;
  group.rotation.y = 0.1;

  scene.add(group);

  // create a point light
  var pointLight = new THREE.PointLight(0xFFFFFF);

  // set its position
  pointLight.position.x = 0;
  pointLight.position.y = 0;
  pointLight.position.z = 500;

  // add to the scene
  scene.add(pointLight);

  projector = new THREE.Projector();

  renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize( window.innerWidth, window.innerHeight );

  document.body.appendChild( renderer.domElement );

}

function animate() {

  // note: three.js includes requestAnimationFrame shim
  requestAnimationFrame( animate );
  render();
}

function render() {

  //group.rotation.x += 0.01;
  group.rotation.z += 0.02;

  // find intersections

  var vector = new THREE.Vector3( mouse.x, mouse.y, 1 );
  projector.unprojectVector( vector, camera );

  var raycaster = new THREE.Raycaster( camera.position, vector.subSelf( camera.position ).normalize() );

  var intersects = raycaster.intersectObjects( [grip1, grip2] );

  if ( intersects.length > 0 ) {

    if ( INTERSECTED != intersects[ 0 ].object ) {

      if ( INTERSECTED ) INTERSECTED.material.emissive.setHex( INTERSECTED.currentHex );

      INTERSECTED = intersects[ 0 ].object;
      INTERSECTED.currentHex = INTERSECTED.material.emissive.getHex();
      INTERSECTED.material.emissive.setHex( 0x0066ff );
      INTERSECTED.material.opacity = 0.5;

    }

  } else {

    if ( INTERSECTED ) {
      INTERSECTED.material.emissive.setHex( INTERSECTED.currentHex );
      INTERSECTED.material.opacity = 0;
    }

    INTERSECTED = null;

  }

  renderer.render( scene, camera );

}

function onDocumentMouseMove( event ) {

  event.preventDefault();

  mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
  mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

}

$(document).on('mousemove', onDocumentMouseMove);

$(document).on('keydown', function (e) {
  switch (e.which) {
    case 38: camera.position.z -= 2; console.log(camera.position.z);
  }
})

init();
animate();
</script>

</html>
